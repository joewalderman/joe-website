---
title: "Parameter Estimation for Wild Fish Catch"
description: |
  Nonlinear least squares analysis of global wild fish catch
author:
  - name: Joe Walderman
    url: {}
date: 03-05-2021
output:
  distill::distill_article:
    self_contained: false
    toc: true
    theme: lumen
    code_folding: hide
---


```{r setup, include=TRUE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(here)
library(janitor)
library(boot) # for bootstrapping
library(gt) # table formatting
library(nlstools) # nonlinear least squares fit
library(broom)
```
## Overview

In this analysis we will use nonlinear least squares to look at wild fish catch data from 1950-2012 generated by the Earth Policy Institute.

## Exploration of the Data: Time Series and Parameter Estimation

```{r}
# Reading in and wrangling the data
fish <- read_csv(here("fishcatch", "fish_catch.csv"), skip = 2) %>% 
  drop_na() %>% 
  clean_names() %>% 
  mutate(year = as.numeric(year)) %>% 
  mutate(wild_catch = as.numeric(wild_catch)) %>% 
  mutate(year_number = 0:62)

# Fish catch time series plot
ggplot(data = fish, aes(x = year, y = wild_catch)) +
  geom_line() +
  scale_y_continuous(breaks = c(10,20,30,40,50,60,70,80,90,100)) +
  labs(x = "Year",
       y = "Fish (Million Tons)",
       title = "Wild Fish Caught 1950-2012") +
  theme_minimal()


fish_exp <- fish %>% 
  filter(year < 1990) %>% 
  mutate(ln_wild = log(wild_catch))

# Linear model to get k estimate
lm_k <- lm(ln_wild ~ year_number, data = fish_exp)
lm_tidy <- tidy(lm_k)
```

This exploratory graph shows a generally increasing trend of wild fish catch over time. The growth pattern seems to be one of logistic growth, exhibited by initial exponential growth eventually leveling off at a carrying capacity. This growth can be described mathematically as:

$P(t) = \frac{K}{1+Ae^{-kt}}$

*K Estimate*: Around 1990 fish catch seems to level off at around 90-95 million tons per year. Thus the estimate for carrying capacity *K* is **95** million tons.

*A Estimate*: The population at 1950, time zero in this case, is ~18 milion tons. Thus *A* ~ $\frac{95-18}{18}$ ~ **4.3**

*k Estimate*: k is estimated by looking at log of wild fish before 1990 to get the growth rate. It is estimated to be *k* = ~**`r round(lm_tidy$estimate[2], 2)`**.

## Nonlinear Least Squares for Parameter Estimation

```{r, results = FALSE}
# NLS Model
fish_nls <- nls(wild_catch ~ K/(1 + A*exp(-r*year_number)),
                data = fish,
                start = list(K = 95,
                             A = 4.3,
                             r = 0.04),
                trace = TRUE)

# Model summary
#summary(fish_nls)

# Tidy output
fish_output <- tidy(fish_nls)
```
```{r}
# Results Table
fish_output %>% 
  mutate(p.value = case_when(
    p.value < 0.0001 ~ "<0.0001"
  )) %>% 
  gt() %>% 
  tab_header(
    title = "Nonlinear Least Squares Output"
  ) %>% 
  fmt_number(columns = vars(estimate, std.error, statistic),
             decimals = 2
  ) %>% 
  cols_label(
    term = "Term",
    estimate = "Estimate",
    std.error = "Standard Error",
    statistic = "Statistic",
    p.value = "P-Value"
  )
```


<br>


For these values the model is expressed as: 

$P(t) = \frac{100.28}{1+4.32e^{0.07t}}$

## Prediction Visualization
```{r}
# Predictions
fish_predict <- predict(fish_nls)

# Combine the data frames into a single plot
fish_complete <- data.frame(fish, fish_predict)

# Plotting
ggplot(data = fish_complete, aes(x = year, y = wild_catch)) +
  geom_point() +
  geom_line(aes(y = fish_predict), color = "orangered3") +
  theme_minimal() +
  labs(x = "Year",
       y = " Wild Fish Caught (Million Tons)",
       title = "Annual Wild Fish Catch from 1950-2012")

```


## Citation:
[Global wild fish catch and aquaculture production, compiled by Earth Policy Institute with 1950-2010 from U.N. Food and Agriculture Organization (FAO), Global Capture Production and Global Aquaculture Production, electronic databases, at www.fao.org/fishery/topic/16140/en.
](https://drive.google.com/file/d/1sKjDqxbpWD7vd7Kt4tBNpl6pHEf_LnIe/view)




